<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MySQL</title>
        <link rel="stylesheet" href="/css/maintheme.css" type="text/css" />
        <script src="/js/main.js" type="text/javascript" defer></script>
    </head>
    <body>
        <div class="header"></div>
        <div class="main">
            <div class="content">
                <h1 class="title">MySQL</h1>
                <h2>基础管理命令</h2>
                <h3>数据库操作</h3>
                <p>显示数据库</p>
                <pre><code>SHOW DATABASES [LIKE 'pattern'];</code></pre>
                <p>示例：</p>
                <pre><code>SHOW DATABASES LIKE 'test%';</code></pre>

                <p>创建数据库</p>
                <pre><code>CREATE DATABASE [IF NOT EXISTS] dbname
    [CHARACTER SET utf8mb4]
    [COLLATE utf8mb4_unicode_ci];</code></pre>
                <div class="tip-box"><span class="icon">💡</span> 建议：生产环境默认使用<code>utf8mb4</code>字符集</div>

                <p>选择数据库</p>
                <pre><code>USE dbname;</code></pre>
                <div class="tip-box"><span class="icon">📌</span> 说明：选择要操作的数据库，后续操作将默认在该数据库上执行</div>
                <div class="tip-box"><span class="icon">💡</span> 提示：可使用<code>SELECT DATABASE();</code>查看当前选择的数据库</div>

                <p>删除数据库</p>
                <pre><code>DROP DATABASE [IF EXISTS] dbname;</code></pre>
                <div class="danger-box"><span class="icon">⚠️</span> 警告：该操作不可逆，建议先执行<code>mysqldump</code>备份</div>

                <h3>用户权限管理</h3>
                <p>创建用户</p>
                <pre><code>CREATE USER 'app_user'@'%.example.com'
    IDENTIFIED BY '强密码要求'
    [REQUIRE SSL]
    [WITH MAX_QUERIES_PER_HOUR 1000];</code></pre>
                <div class="tip-box"><span class="icon">🔒</span> 安全建议：遵循最小权限原则，避免使用<code>'%'</code>通配符</div>

                <p>授权管理</p>
                <pre><code>GRANT SELECT, INSERT ON dbname.* TO 'app_user'@'host';
GRANT ALL PRIVILEGES ON dbname.* TO 'admin'@'localhost' WITH GRANT OPTION;</code></pre>
                <div class="tip-box"><span class="icon">📝</span> 记录：使用<code>SHOW GRANTS</code>验证权限配置</div>

                <h2>数据定义语言(DDL)</h2>
                <h3>表结构操作</h3>
                <p>创建表</p>
                <pre><code>CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</code></pre>
                <p>🔧 关键特性：自动递增主键、唯一约束、默认值设置、显式指定存储引擎</p>

                <p>修改表结构</p>
                <pre><code>ALTER TABLE orders
    ADD COLUMN total_amount DECIMAL(10,2) NOT NULL,
    MODIFY COLUMN status ENUM('pending','paid','shipped') NOT NULL DEFAULT 'pending',
    DROP INDEX idx_order_no,
    ADD INDEX idx_customer_id (customer_id);</code></pre>
                <div class="warning-box"><span class="icon">⚠️</span> 注意：生产环境修改大表需在维护窗口操作</div>

                <h3>索引优化</h3>
                <p>创建索引</p>
                <pre><code>CREATE INDEX idx_last_name ON employees(last_name);
CREATE UNIQUE INDEX idx_unique_email ON users(email);</code></pre>
                <p>📊 最佳实践：联合索引字段顺序遵循最左前缀原则、定期执行<code>ANALYZE TABLE</code>更新统计信息、避免对频繁更新的列建索引</p>

                <h2>数据查询优化</h2>
                <h3>执行计划分析</h3>
                <p>EXPLAIN命令</p>
                <pre><code>EXPLAIN SELECT * FROM orders
    WHERE customer_id = 123
    ORDER BY order_date DESC
    LIMIT 10;</code></pre>
                <p>🔍 关键指标：type：访问类型（ALL < index < range < ref < eq_ref < const）、key：实际使用的索引、rows：预计扫描行数</p>

                <h3>高级查询</h3>
                <p>窗口函数(MySQL 8.0+)</p>
                <pre><code>SELECT 
    department,
    salary,
    RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS dept_rank
FROM employees;</code></pre>

                <p>JSON支持</p>
                <pre><code>SELECT data->'$.contact.email' FROM profiles;
UPDATE settings SET config = JSON_SET(config, '$.logging.level', 'debug');</code></pre>

                <h2>维护与备份</h2>
                <p>逻辑备份</p>
                <pre><code>mysqldump -u root -p --single-transaction --routines --events dbname > backup.sql</code></pre>
                <p>💾 恢复命令：<code>mysql -u root -p dbname < backup.sql</code></p>

                <p>物理备份</p>
                <pre><code>innobackupex --user=root --password=secret /backup/dir</code></pre>
                <div class="tip-box"><span class="icon">⏱</span> 建议：配合Percona XtraBackup实现热备</div>

                <h2>安全加固建议</h2>
                <p>禁用本地文件加载：<code>SET GLOBAL local_infile=0;</code></p>
                <p>限制访问来源：<code>bind-address = 192.168.1.100</code></p>
                <p>启用审计插件：<code>INSTALL PLUGIN audit_log SONAME 'audit_log.so';</code></p>
                <p>定期轮换密码：设置<code>password_lifetime</code>参数</p>
                <p>监控慢查询：配置<code>long_query_time=2</code></p>
            </div>
        </div>
    </body>
</html>
